<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TRX Panel</title>
  <link rel="stylesheet" href="style.css?v=26" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#2b6cff" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
</head>
<body>

  <!-- Toasts -->
  <div id="toastHost" class="toastHost" aria-live="polite" aria-atomic="true"></div>

  <!-- Notification Center -->
  <aside id="notifyPanel" class="drawer" aria-hidden="true" aria-label="Notificaciones">
    <div class="drawerHead">
      <div>
        <div class="drawerTitle">Notificaciones</div>
        <div class="drawerSub" id="notifySub">0</div>
      </div>
      <div class="drawerBtns">
        <button id="btnNotifyClear" class="btn ghost" type="button">Limpiar</button>
        <button id="btnNotifyClose" class="iconBtn" type="button" aria-label="Cerrar">‚úï</button>
      </div>
    </div>
    <div class="drawerBody" id="notifyList"></div>
  </aside>
  <div id="drawerOverlay" class="drawerOverlay" aria-hidden="true"></div>

  <!-- Confirm Modal -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="modalBackdrop" data-close="1"></div>
    <div class="modalCard" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modalHead">
        <div>
          <div id="modalTitle" class="modalTitle">Confirmaci√≥n</div>
          <div id="modalDesc" class="modalDesc"></div>
        </div>
        <button class="iconBtn" id="modalX" type="button" aria-label="Cerrar">‚úï</button>
      </div>
      <div class="modalActions">
        <button id="modalCancel" class="btn ghost" type="button">Cancelar</button>
        <button id="modalOk" class="btn primary" type="button">Aceptar</button>
      </div>
    </div>
  </div>

  <!-- Edit Task Modal -->
  <div id="editModal" class="modal" aria-hidden="true">
    <div class="modalBackdrop" data-close-edit="1"></div>
    <div class="modalCard" role="dialog" aria-modal="true" aria-labelledby="editTitle">
      <div class="modalHead">
        <div>
          <div id="editTitle" class="modalTitle">Editar tarea</div>
          <div class="modalDesc">Actualiza campos y guarda.</div>
        </div>
        <button class="iconBtn" id="editX" type="button" aria-label="Cerrar">‚úï</button>
      </div>

      <form id="editForm" class="formGrid">
        <div class="field">
          <label class="lbl" for="editType">Categor√≠a</label>
          <select id="editType">
            <option value="task">Tarea</option>
            <option value="event">Evento</option>
          </select>
        </div>

        <div class="field">
          <label class="lbl" for="editText">Nombre</label>
          <input id="editText" type="text" required />
        </div>

        <div class="row2">
          <div class="field">
            <label class="lbl" for="editPriority">Prioridad</label>
            <select id="editPriority">
              <option value="low">Baja</option>
              <option value="med">Media</option>
              <option value="high">Alta</option>
            </select>
          </div>

          <div class="field">
            <label class="lbl" for="editStatus">Estado</label>
            <select id="editStatus">
              <option value="todo">Pendiente</option>
              <option value="doing">En curso</option>
              <option value="done">Hecho</option>
            </select>
          </div>
        </div>

        <div class="row2">
          <div class="field">
            <label class="lbl" for="editStart">Fecha inicio</label>
            <input id="editStart" type="date" />
          </div>
          <div class="field">
            <label class="lbl" for="editStartTime">Hora inicio</label>
            <input id="editStartTime" type="time" />
          </div>
        </div>

        <div class="row2">
          <div class="field">
            <label class="lbl" for="editEnd">Fecha fin</label>
            <input id="editEnd" type="date" />
          </div>
          <div class="field">
            <label class="lbl" for="editEndTime">Hora fin</label>
            <input id="editEndTime" type="time" />
          </div>
        </div>

        <div class="field">
          <label class="lbl" for="editTags">Tags (separados por coma)</label>
          <input id="editTags" type="text" placeholder="trabajo, estudio, m√∫sica" />
        </div>

        <div class="field">
          <label class="lbl" for="editColor">Color del borde</label>
          <div class="colorRow">
            <input id="editColor" class="colorInput" type="color" value="#3b82f6" />
            <button id="saveFavColorEdit" class="btn ghost sm" type="button" title="Guardar color favorito">‚òÖ</button>
          </div>
          <div id="favColorsEdit" class="favColors" aria-label="Colores favoritos"></div>
        </div>

        <div class="modalActions">
          <button id="editCancel" class="btn ghost" type="button">Cancelar</button>
          <button class="btn primary" type="submit">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Command Palette -->
  <div id="cmdk" class="modal" aria-hidden="true">
    <div class="modalBackdrop" data-close-cmdk="1"></div>
    <div class="cmdkCard" role="dialog" aria-modal="true" aria-labelledby="cmdkTitle">
      <div class="cmdkHead">
        <div id="cmdkTitle" class="cmdkTitle">Comandos</div>
        <button class="iconBtn" id="cmdkX" type="button" aria-label="Cerrar">‚úï</button>
      </div>
      <input id="cmdkInput" class="cmdkInput" type="text" placeholder="Buscar: tareas, stats, tema, nueva..." autocomplete="off" />
      <div id="cmdkList" class="cmdkList" role="listbox" aria-label="Resultados"></div>
      <div class="cmdkHint">Enter para ejecutar ¬∑ Esc para cerrar</div>
    </div>
  </div>

  <!-- Login Gate -->
  <div id="authGate" class="gate">
    <div class="gateCard">
      <div class="gateBrand">
        <img src="icons/mi-logo.png" alt="Logo TRX" class="logoImg" />
        <div>
          <h1>TRX Panel</h1>
          <p>Acceso</p>
        </div>
      </div>

      <form id="loginForm" class="gateForm" data-mode="login">
        <div class="field" id="regNameField" style="display:none">
          <label class="lbl">Nombre de usuario</label>
          <input id="regName" type="text" autocomplete="nickname" placeholder="Tu nombre" maxlength="40" />
        </div>

        <div class="field">
          <label class="lbl">Correo</label>
          <input id="loginEmail" type="email" autocomplete="email" placeholder="tuemail@correo.com" required />
        </div>

        <div class="field">
          <label class="lbl">Contrase√±a</label>
          <div class="pwWrap">
            <input id="loginPass" type="password" autocomplete="current-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
            <button id="pwToggle" class="iconBtn" type="button" aria-label="Mostrar/ocultar">üëÅ</button>
          </div>
        </div>

        <button id="loginBtn" class="btn primary" type="submit">
          <span class="btnText">Entrar</span>
          <span class="spinner" aria-hidden="true"></span>
        </button>

        <button id="authModeToggle" class="btn ghost" type="button">Crear cuenta</button>

        <div id="authHint" class="authHint">Inicia sesi√≥n con tu correo (no con nombre de usuario).</div>

        <div id="loginErr" class="err" aria-live="polite"></div>
      </form>

      <div class="gateFoot">
        <span class="chip" id="authModeChip">Login</span>
        <span class="chip">Supabase Auth</span>
      </div>
    </div>
  </div>

  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sbTop">
        <div class="sbBrand">
          <img src="icons/mi-logo.png" alt="Logo TRX" class="logoImg small" />
          <div class="sbTitle">
            <div class="name">TRX</div>
            <div class="sub" id="who"></div>
          </div>
        </div>

        <nav class="sbNav" role="tablist" aria-label="Navegaci√≥n">
          <button class="tab active" data-tab="overview" role="tab" aria-selected="true">
            <span class="ic">‚åÅ</span><span>Resumen</span>
          </button>
          <button class="tab" data-tab="tasks" role="tab" aria-selected="false">
            <span class="ic">‚úì</span><span>Tareas</span>
          </button>
                    <button class="tab" data-tab="calendar" role="tab" aria-selected="false">
            <span class="ic">üìÖ</span><span>Calendario</span>
          </button>
          <button class="tab" data-tab="agenda" role="tab" aria-selected="false">
            <span class="ic">üóìÔ∏è</span><span>Agenda</span>
          </button>          <button class="tab" data-tab="lists" role="tab" aria-selected="false">
            <span class="ic">üìã</span><span>Listas</span>
          </button>
          <button class="tab" data-tab="timer" role="tab" aria-selected="false">
            <span class="ic">‚è±</span><span>Temporizador</span>
          </button>
<button class="tab" data-tab="notes" role="tab" aria-selected="false">
            <span class="ic">‚úé</span><span>Notas</span>
          </button>
          <button class="tab" data-tab="stats" role="tab" aria-selected="false">
            <span class="ic">‚ñ¶</span><span>Stats</span>
          </button>
        
          <button class="tab" data-tab="app" role="tab" aria-selected="false">
            <span class="ic">üì≤</span><span>APP</span>
          </button>
</nav>
      </div>

      <div class="sbBottom">
        <div class="sbMeta">
          <span id="today"></span>
          <span class="dot">‚Ä¢</span>
          <span id="clock"></span>
        </div>

        <div class="sbActions">
          <button id="btnTheme" class="btn ghost" type="button">Tema</button>
          <button id="btnDensity" class="btn ghost" type="button">Densidad</button>
          <button id="btnNotify" class="btn ghost" type="button">Notifs</button>
          <button id="btnReset" class="btn danger" type="button">Reiniciar</button>
          <button id="btnLogout" class="btn ghost" type="button">Salir</button>
        </div>
      </div>
    </aside>

    <!-- Mobile sidebar overlay -->
    <div id="sbOverlay" class="sbOverlay" aria-hidden="true"></div>

    <!-- Content -->
    <main class="content">
      <header class="topbar">
        <button id="btnMenu" class="iconBtn menuBtn" type="button" aria-label="Men√∫">‚ò∞</button>

        <div class="topTitle">
          <div class="h">Panel</div>
          <div class="p">Gesti√≥n y m√©tricas</div>
          <div class="discordQuickBar" id="discordQuickBar">
            <button class="btn ghost sm dqBtn" type="button" data-discord-form="peticiones">Peticiones</button>
            <button class="btn ghost sm dqBtn" type="button" data-discord-form="reportes">Reportes</button>
            <button class="btn ghost sm dqBtn" type="button" data-discord-form="sugerencias">Sugerencias</button>
            <button class="btn ghost sm dqBtn" type="button" data-discord-form="contacto">Contacto</button>
          </div>
        </div>

        <div class="topPills">
          <span class="pill" id="streak">0</span>
          <span class="pill subtle" id="statTotal">0</span>
          <button id="btnCmdk" class="iconBtn" type="button" aria-label="Comandos">‚åòK</button>
        </div>
      </header>

      <!-- OVERVIEW -->
      <section class="panel active" id="overview" role="tabpanel">
        

        <div class="grid3">
          <div class="card statCard">
            <div class="k">Total</div>
            <div class="v" id="statTotal_dup">0</div>
            <div class="s">tareas</div>
          </div>
          <div class="card statCard">
            <div class="k">Hechas</div>
            <div class="v" id="statDone">0</div>
            <div class="s">completadas</div>
          </div>
          <div class="card statCard">
            <div class="k">Pendientes</div>
            <div class="v" id="statPending">0</div>
            <div class="s">por hacer</div>
          </div>
        </div>

        <div class="grid2">
          <div class="card">
            <div class="cardHead">
              <h2>Recientes</h2>
              <span class="pill subtle">√∫ltimas</span>
            </div>
            <ul id="recentList" class="miniList"></ul>
          </div>

          <div class="card">
            <div class="cardHead">
              <h2>Notas r√°pidas</h2>
              <span class="pill subtle" id="notesCount">0</span>
            </div>
            <div class="notesBar">
              <input id="noteInputMini" type="text" placeholder="Escribe una nota..." autocomplete="off" />
              <button id="addNoteBtnMini" class="btn primary" type="button">A√±adir</button>
            </div>
            <div id="notesBoardMini" class="notesBoard mini" aria-label="Notas (mini)"></div>
          </div>
        </div>
      </section>

      <!-- TASKS -->
      <section class="panel" id="tasks" role="tabpanel">
        <div class="card">
          <div class="cardHead">
            <div class="row spread">
              <h2 style="margin:0">Tareas</h2>
              <div class="row compact onlyMobile">
                <button id="btnTaskNew" type="button" class="btn primary sm">+ Nueva</button>
                <button id="btnTaskFilters" type="button" class="btn ghost sm">Filtrar</button>
              </div>
            </div>

            <!-- Controles (desktop inline, m√≥vil como modal) -->
            <div id="taskControlsPanel" class="taskControlsPanel">
              <div class="row spread onlyMobile" style="margin-bottom:8px">
                <div class="h3" style="margin:0">Filtros</div>
                <button id="btnTaskFiltersClose" type="button" class="btn ghost sm">‚úï</button>
              </div>
              <div class="row compact">
                <input id="searchInput" type="text" placeholder="Buscar..." />
                <select id="filterSelect" aria-label="Filtrar por estado">
                  <option value="all" selected>Todas</option>
                  <option value="todo">Pendientes</option>
                  <option value="doing">En curso</option>
                  <option value="done">Hechas</option>
                </select>
                <select id="viewSelect" aria-label="Vista">
                  <option value="list" selected>Lista</option>
                  <option value="kanban">Kanban</option>
                </select>
              </div>
            </div>
          </div>

          <div class="taskLayout">
            <!-- Crear (desktop: panel lateral | m√≥vil: bottom sheet) -->
            <div id="taskCreatePanel" class="taskCreatePanel" aria-label="Crear tarea">
              <div class="row spread taskCreateHead">
                <div class="h3" style="margin:0">Nueva tarea</div>
                <button id="btnTaskNewClose" type="button" class="btn ghost sm onlyMobile">‚úï</button>
              </div>

              <form id="taskForm" class="row">
                <select id="taskType" aria-label="Categor√≠a">
                  <option value="task" selected>Tarea</option>
                  <option value="event">Evento</option>
                </select>
                <input id="taskInput" type="text" placeholder="Nombre de la tarea/evento..." autocomplete="off" />

                <div class="row2 inline2">
                  <div class="field">
                    <label class="lbl srOnly" for="taskStart">Fecha inicio</label>
                    <input id="taskStart" type="date" aria-label="Fecha de inicio" />
                  </div>
                  <div class="field">
                    <label class="lbl srOnly" for="taskStartTime">Hora inicio</label>
                    <input id="taskStartTime" type="time" aria-label="Hora de inicio" />
                  </div>
                </div>

                <div class="row2 inline2">
                  <div class="field">
                    <label class="lbl srOnly" for="taskEnd">Fecha fin</label>
                    <input id="taskEnd" type="date" aria-label="Fecha de finalizaci√≥n" />
                  </div>
                  <div class="field">
                    <label class="lbl srOnly" for="taskEndTime">Hora fin</label>
                    <input id="taskEndTime" type="time" aria-label="Hora de finalizaci√≥n" />
                  </div>
                </div>

                <input id="taskTags" type="text" placeholder="Tags: trabajo, m√∫sica..." />
                <select id="taskPriority" aria-label="Prioridad">
                  <option value="low">Baja</option>
                  <option value="med" selected>Media</option>
                  <option value="high">Alta</option>
                </select>

                <div class="colorBox">
                  <input id="taskColor" class="colorInput" type="color" value="#3b82f6" aria-label="Color del borde" title="Color del borde" />
                  <button id="saveFavColor" class="btn ghost sm" type="button" title="Guardar color favorito">‚òÖ</button>
                </div>
                <div id="favColors" class="favColors" aria-label="Colores favoritos"></div>

                <button class="btn primary" type="submit">A√±adir</button>
              </form>
            </div>

            <!-- Ver / gestionar -->
            <div class="taskMainPanel">
              <!-- Chips -->
              <div class="chipRow">
                <div class="chipLabel">Tags:</div>
                <div id="tagChips" class="chipWrap"></div>
                <button id="btnClearTag" class="btn ghost sm" type="button">Quitar filtro</button>
              </div>

              <!-- Skeleton -->
              <div id="tasksSkeleton" class="skeletonWrap" aria-hidden="true"></div>

              <!-- List View -->
              <ul id="taskList" class="list"></ul>

              <!-- Kanban View -->
              <div id="kanban" class="kanban" aria-label="Tablero Kanban">
                <div class="kCol" data-status="todo">
                  <div class="kHead"><span>Pendiente</span><span class="kCount" id="kTodo">0</span></div>
                  <div class="kBody" id="kTodoBody"></div>
                </div>
                <div class="kCol" data-status="doing">
                  <div class="kHead"><span>En curso</span><span class="kCount" id="kDoing">0</span></div>
                  <div class="kBody" id="kDoingBody"></div>
                </div>
                <div class="kCol" data-status="done">
                  <div class="kHead"><span>Hecho</span><span class="kCount" id="kDone">0</span></div>
                  <div class="kBody" id="kDoneBody"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Overlay para sheets/modales -->
          <div id="tasksOverlay" class="tasksOverlay" hidden></div>
        </div>
      </section>

      <!-- NOTES -->
      
      <section class="panel" id="calendar" role="tabpanel">
        <div class="card">
          <div class="row spread">
            <div>
              <div class="h2">Calendario</div>
              <div class="muted">Vista mensual con tareas y eventos por fecha.</div>
            </div>
            <div class="row" style="gap:8px; flex-wrap:wrap; justify-content:flex-end">
              <button class="btn ghost" id="calToday" type="button">Hoy</button>
              <button class="btn ghost" id="calPrev" type="button">‚óÄ</button>
              <button class="btn ghost" id="calNext" type="button">‚ñ∂</button>
            </div>
          </div>

          <div class="calHead">
            <div class="calMonth" id="calMonthLabel"></div>
            <div class="calLegend">
              <span class="dot todo"></span><span class="muted">Pendiente</span>
              <span class="dot doing"></span><span class="muted">En curso</span>
              <span class="dot done"></span><span class="muted">Completado</span>
            </div>
          </div>

          <div id="calendarGrid" class="calendar"></div>
        </div>
      </section>

      <!-- AGENDA -->
      <section class="panel" id="agenda" role="tabpanel">
        <div class="card">
          <div class="row spread" style="gap:12px; align-items:flex-end; flex-wrap:wrap">
            <div>
              <div class="h2">Agenda</div>
              <div class="muted">Lista por fechas (ideal para m√≥vil).</div>
            </div>

            <div class="row" style="gap:8px; flex-wrap:wrap; justify-content:flex-end">
              <button class="btn ghost" id="agToday" type="button">Hoy</button>
              <button class="btn ghost" id="agTomorrow" type="button">Ma√±ana</button>
              <button class="btn ghost" id="agWeek" type="button">7 d√≠as</button>
              <button class="btn ghost" id="agMonth" type="button">30 d√≠as</button>
              <button class="btn ghost" id="agAll" type="button">Todo</button>
            </div>
          </div>

          <div id="agendaList" class="agendaList" aria-label="Agenda"></div>
        </div>
      </section>
      <!-- LISTAS -->
      <section class="panel" id="lists" role="tabpanel">
        <div class="card">
          <div class="row spread">
            <div>
              <div class="h2">Listas</div>
              <div class="muted">Listas privadas y compartidas con otros usuarios.</div>
            </div>
            <div class="row compact">
              <button id="btnListNew" type="button" class="btn primary">+ Nueva lista</button>
            </div>
          </div>

          <div class="listsLayout">
            <aside class="listsSide">
              <div class="row spread" style="margin-bottom:8px">
                <div class="h3" style="margin:0">Mis listas</div>
                <span class="pill" id="listsCount">0</span>
              </div>
              <div id="listsList" class="listsList"></div>
              <div class="muted" id="listsEmptyHint" style="margin-top:10px">Crea una lista para empezar (p.ej. ‚ÄúVIAJE LONDRES‚Äù).</div>
            </aside>

            <div class="listsMain">
              <div id="listEmpty" class="muted" style="padding:14px">Selecciona una lista para ver su contenido.</div>

              <div id="listDetail" class="listDetail" hidden>
                <div class="row spread">
                  <div>
                    <div class="h2" id="listTitle" style="margin:0">‚Äî</div>
                    <div class="muted" id="listMeta"></div>
                  </div>
                  <div class="row compact">
                    <button id="btnListShare" type="button" class="btn ghost">Compartir</button>
                    <button id="btnListDelete" type="button" class="btn danger">Eliminar</button>
                  </div>
                </div>

                <div id="listSharePanel" class="card subCard" hidden>
                  <div class="row spread">
                    <div class="h3" style="margin:0">Compartir lista</div>
                    <button id="btnListShareClose" type="button" class="btn ghost sm">‚úï</button>
                  </div>
                  <div class="row compact" style="margin-top:8px">
                    <input id="shareUsername" type="text" placeholder="Usuario (username)..." autocomplete="off" />
                    <button id="btnShareAdd" type="button" class="btn primary">A√±adir</button>
                  </div>
                  <div class="muted" style="margin-top:8px">Solo el due√±o puede compartir. Los usuarios a√±adidos podr√°n verla y editar sus items.</div>
                  <div id="shareChips" class="chipRow" style="margin-top:10px"></div>
                </div>

                <div class="row compact" style="margin-top:12px">
                  <input id="listItemInput" type="text" placeholder="A√±adir item..." autocomplete="off" />
                  <button id="btnListItemAdd" type="button" class="btn primary">A√±adir</button>
                </div>

                <div id="listItems" class="listItems" style="margin-top:12px"></div>
              </div>
            </div>
          </div>

          <!-- modal nueva lista -->
          <div id="listsOverlay" class="tasksOverlay" hidden></div>
          <div id="listCreateModal" class="modalCard" hidden>
            <div class="row spread">
              <div class="h3" style="margin:0">Nueva lista</div>
              <button id="btnListCreateClose" type="button" class="btn ghost sm">‚úï</button>
            </div>
            <div class="row" style="margin-top:10px">
              <input id="newListTitle" type="text" placeholder="Nombre (p.ej. VIAJE LONDRES)" autocomplete="off" />
              <select id="newListVisibility" aria-label="Visibilidad">
                <option value="private" selected>Privada (solo t√∫)</option>
                <option value="shared">Compartida (solo invitados)</option>
              </select>
              <button id="btnListCreate" type="button" class="btn primary">Crear</button>
            </div>
          </div>
        </div>
      </section>




      <!-- TIMER -->
<section class="panel" id="timer" role="tabpanel" data-mode="timer">
  <div class="card">
    <div class="row spread">
      <div>
        <div class="h2">Temporizador</div>
        <div class="seg" role="tablist" aria-label="Modo temporizador">
          <button id="timerModeTimer" class="segBtn active" type="button" aria-selected="true">Normal</button>
          <button id="timerModePomodoro" class="segBtn" type="button" aria-selected="false">Pomodoro</button>
        </div>
      </div>

      <div class="row timerOnly" style="gap:8px; flex-wrap:wrap; justify-content:flex-end">
        <button class="btn ghost" id="timerPreset5" type="button">5 min</button>
        <button class="btn ghost" id="timerPreset10" type="button">10 min</button>
        <button class="btn ghost" id="timerPreset25" type="button">25 min</button>
      </div>
    </div>

    <div class="timerLayout">
      <div class="timerRing" aria-label="Cuenta atr√°s">
        <svg class="timerSvg" viewBox="0 0 120 120" aria-hidden="true">
          <circle class="timerTrack" cx="60" cy="60" r="46" pathLength="100"></circle>
          <circle class="timerProg" cx="60" cy="60" r="46" pathLength="100"></circle>
        </svg>

        <div class="timerCenter">
          <div id="timerDigits" class="timerDigits">00:25</div>
          <div id="pomoPhase" class="timerPhase pomoOnly">Trabajo</div>
          <div id="pomoCount" class="timerPhaseSub pomoOnly">0 pomodoros</div>
        </div>
      </div>

      <div class="timerControls">
        <div class="row3 timerOnly">
          <div class="field">
            <label class="lbl" for="timerMin">Min</label>
            <input id="timerMin" type="number" min="0" max="999" step="1" value="0" />
          </div>
          <div class="field">
            <label class="lbl" for="timerSec">Seg</label>
            <input id="timerSec" type="number" min="0" max="59" step="1" value="25" />
          </div>
          <div class="field">
            <label class="lbl" for="timerVol">Sonido</label>
            <select id="timerVol">
              <option value="0">Off</option>
              <option value="0.2">Bajo</option>
              <option value="0.5" selected>Medio</option>
              <option value="0.9">Alto</option>
            </select>
          </div>
        </div>

        <div class="pomoOnly">
          <div class="row spread" style="margin-bottom:10px; align-items:flex-end; flex-wrap:wrap; gap:10px">
            <div class="row" style="gap:8px; flex-wrap:wrap">
              <button id="pomoPhaseWork" class="btn ghost sm" type="button">Trabajo</button>
              <button id="pomoPhaseShort" class="btn ghost sm" type="button">Descanso</button>
              <button id="pomoPhaseLong" class="btn ghost sm" type="button">Largo</button>
            </div>

            <div class="row" style="gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end">
              <label class="checkRow">
                <input id="pomoAuto" type="checkbox" checked />
                <span>Auto-cambiar</span>
              </label>
              <div class="field" style="min-width:140px">
                <label class="lbl" for="timerVolPomo">Sonido</label>
                <select id="timerVolPomo">
                  <option value="0">Off</option>
                  <option value="0.2">Bajo</option>
                  <option value="0.5" selected>Medio</option>
                  <option value="0.9">Alto</option>
                </select>
              </div>
            </div>
          </div>

          <div class="row4">
            <div class="field">
              <label class="lbl" for="pomoWork">Trabajo (min)</label>
              <input id="pomoWork" type="number" min="1" max="180" step="1" value="25" />
            </div>
            <div class="field">
              <label class="lbl" for="pomoShort">Descanso (min)</label>
              <input id="pomoShort" type="number" min="1" max="60" step="1" value="5" />
            </div>
            <div class="field">
              <label class="lbl" for="pomoLong">Largo (min)</label>
              <input id="pomoLong" type="number" min="1" max="120" step="1" value="15" />
            </div>
            <div class="field">
              <label class="lbl" for="pomoEvery">Largo cada</label>
              <input id="pomoEvery" type="number" min="2" max="10" step="1" value="4" />
            </div>
          </div>

          <div class="pomoPresets" aria-label="Configuraciones guardadas">
            <div class="row spread" style="align-items:flex-end; gap:10px; flex-wrap:wrap">
              <div>
                <div class="muted" style="font-weight:900; letter-spacing:.2px">Configuraciones</div>
                <div class="muted" style="font-size:12px">Guarda hasta 10 combinaciones de tiempos.</div>
              </div>

              <div class="row" style="gap:10px; flex-wrap:wrap; justify-content:flex-end">
                <div class="field" style="min-width:220px">
                  <label class="lbl" for="pomoPresetName">Nombre</label>
                  <input id="pomoPresetName" type="text" maxlength="40" placeholder="Ej: Estudiar mates" autocomplete="off" />
                </div>
                <button id="pomoPresetSave" class="btn ghost" type="button">Guardar</button>
              </div>
            </div>

            <div id="pomoPresetList" class="pomoPresetList" aria-label="Lista de configuraciones"></div>
          </div>
        </div>

      </div>
    </div>

    <div class="timerActions">
      <div class="row" style="gap:10px; flex-wrap:wrap; justify-content:center">
        <button id="timerStart" class="btn primary" type="button">Iniciar</button>
        <button id="timerPause" class="btn ghost" type="button">Pausar</button>
        <button id="timerReset" class="btn danger" type="button">Reiniciar</button>
      </div>

      <div class="timerMeta">
        <div class="muted" id="timerMeta">Duraci√≥n: ‚Äî</div>
      </div>
    </div>
  </div>
</section>

<section class="panel" id="notes" role="tabpanel">
        <div class="card">
          <div class="cardHead">
            <h2>Notas</h2>
            <span class="pill subtle" id="notesCount_dup">0</span>
          </div>

          <div class="notesBar">
            <input id="noteInput" type="text" placeholder="Escribe una nota r√°pida..." autocomplete="off" />
            <button id="addNoteBtn" class="btn primary" type="button">A√±adir</button>
          </div>

          <div class="notesMeta">
            <span class="muted">Tip: fija las importantes para que salgan arriba.</span>
          </div>

          <div id="notesBoard" class="notesBoard" aria-label="Notas tipo post-it"></div>
        </div>
      </section>

      <!-- STATS -->
      <section class="panel" id="stats" role="tabpanel">
        <div class="card">
          <div class="cardHead">
            <h2>Estad√≠sticas</h2>
            <div class="row compact">
              <select id="rangeSelect" aria-label="Rango">
                <option value="7" selected>7 d√≠as</option>
                <option value="14">14 d√≠as</option>
                <option value="30">30 d√≠as</option>
              </select>
              <button id="btnRecalc" class="btn ghost" type="button">Actualizar</button>
            </div>
          </div>

          <div id="statsSkeleton" class="skeletonWrap" aria-hidden="true"></div>

          <div class="grid2 statsGrid">
            <div class="card mini">
              <div class="miniHead">
                <span class="muted">Hechas por d√≠a</span>
                <span class="pill subtle" id="doneTotalInRange">0</span>
              </div>
              <canvas id="chartDone" height="170"></canvas>
            </div>

            <div class="card mini">
              <div class="miniHead">
                <span class="muted">Prioridades</span>
                <span class="pill subtle" id="prioTotal">0</span>
              </div>
              <canvas id="chartPrio" height="170"></canvas>
            </div>
          </div>

          <div class="card mini">
            <div class="miniHead">
              <span class="muted">Creaci√≥n por d√≠a</span>
              <span class="pill subtle" id="createdTotalInRange">0</span>
            </div>
            <canvas id="chartCreated" height="200"></canvas>
          </div>
        </div>
      </section>

    

      <!-- APP / INSTALACI√ìN -->
      <section class="panel" id="app" role="tabpanel">
        <div class="card">
          <div class="cardHead">
            <h2>APP</h2>
            <div class="muted" style="font-size:12px">Instala TRX Panel en tu m√≥vil para abrirlo a pantalla completa y usarlo sin conexi√≥n.</div>
          </div>

          <div class="installCardInline">
            <div class="installLeft">
              <img class="installIcon" src="./icons/icon-192.png" alt="TRX icon" />
              <div class="installText">
                <div class="installTitle">TRX Panel</div>
                <div class="installSub">Acceso r√°pido, pantalla completa y offline.</div>
              </div>
            </div>

            <div class="installActions">
              <button id="btnInstallApp" type="button" class="installBtn btnPrimary">Instalar</button>
              <button id="btnInstallHelp" type="button" class="installBtn btnGhost">C√≥mo instalar</button>
            </div>
          </div>

          <div class="muted" style="margin-top:10px; font-size:12px">
            Nota: En iPhone/iPad se instala desde Safari (bot√≥n Compartir ‚Üí ‚ÄúA√±adir a pantalla de inicio‚Äù).
          </div>
        </div>
      </section>

    </main>
  </div>

  

<!-- Day details modal (Calendario) -->
<div id="dayModal" class="modal" aria-hidden="true">
  <div class="modalBackdrop" data-close-day="1"></div>
  <div class="modalCard" role="dialog" aria-modal="true" aria-labelledby="dayModalTitle">
    <div class="modalHead">
      <div>
        <div id="dayModalTitle" class="modalTitle">D√≠a</div>
        <div id="dayModalSub" class="modalDesc">Tareas y eventos</div>
      </div>
      <button class="iconBtn" id="dayModalX" type="button" aria-label="Cerrar">‚úï</button>
    </div>
    <div class="dayModalBody">
      <div id="dayModalList" class="dayList"></div>
      <div class="muted" style="font-size:12px; margin-top:10px">Tip: toca una tarjeta para editarla.</div>
    </div>
    <div class="modalActions">
      <button id="dayModalClose" class="btn ghost" type="button">Cerrar</button>
    </div>
  </div>
</div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="script.js?v=26"></script>
<!-- Install FAB (Mobile) -->
<!-- Discord forms modal -->
<div id="discordFormModal" class="modal" aria-hidden="true">
  <div class="modalBackdrop" data-close-discord="1"></div>
  <div class="modalCard discordModalCard" role="dialog" aria-modal="true" aria-labelledby="discordFormTitle">
    <div class="modalHead">
      <div>
        <div id="discordFormTitle" class="modalTitle">Enviar a Discord</div>
        <div id="discordFormDesc" class="modalDesc">Se enviar√° al canal correspondiente.</div>
      </div>
      <button class="iconBtn" id="discordFormX" type="button" aria-label="Cerrar">‚úï</button>
    </div>
    <form id="discordForm" class="discordForm">
      <input type="hidden" id="discordFormType" />
      <div class="grid2 discordGrid">
        <div>
          <label class="label" for="discordFormName">Nombre</label>
          <input id="discordFormName" class="input" type="text" maxlength="50" placeholder="Tu nombre" required />
        </div>
        <div>
          <label class="label" for="discordFormContact">Contacto</label>
          <input id="discordFormContact" class="input" type="text" maxlength="80" placeholder="Discord, correo, etc. (opcional)" />
        </div>
      </div>
      <div>
        <label class="label" for="discordFormSubject">Asunto</label>
        <input id="discordFormSubject" class="input" type="text" maxlength="90" placeholder="T√≠tulo breve" required />
      </div>
      <div>
        <label class="label" for="discordFormMessage">Mensaje</label>
        <textarea id="discordFormMessage" class="input" rows="5" maxlength="1800" placeholder="Escribe aqu√≠ los detalles" required></textarea>
      </div>
      <div class="discordFormFoot">
        <div id="discordFormHint" class="muted">Canal: ‚Äî</div>
        <div class="row compact">
          <button id="discordFormCancel" type="button" class="btn ghost">Cancelar</button>
          <button id="discordFormSend" type="submit" class="btn primary">Enviar</button>
        </div>
      </div>
    </form>
  </div>
</div>
<!-- iOS Install Help (Bottom Sheet) -->
<div id="installHelp" class="sheet" hidden>
  <div class="sheetBackdrop"></div>
  <div class="sheetPanel" role="dialog" aria-modal="true" aria-labelledby="sheetTitle">
    <div class="sheetHandle"></div>
    <div class="sheetHeader">
      <div>
        <div id="sheetTitle" class="sheetTitle">Instalar en iPhone / iPad</div>
        <div class="sheetSub">Safari ‚Üí Compartir ‚Üí A√±adir a pantalla de inicio</div>
      </div>
      <button id="btnSheetClose" type="button" class="btnIcon" aria-label="Cerrar">‚úï</button>
    </div>

    <div class="sheetSteps">
      <div class="step">
        <div class="stepNum">1</div>
        <div class="stepBody">
          <div class="stepTitle">Abre esta web en Safari</div>
          <div class="stepDesc">En iOS solo se instala desde Safari.</div>
        </div>
      </div>

      <div class="step">
        <div class="stepNum">2</div>
        <div class="stepBody">
          <div class="stepTitle">Pulsa Compartir</div>
          <div class="stepDesc">El bot√≥n <strong>Compartir</strong> (cuadrado con flecha hacia arriba).</div>
        </div>
      </div>

      <div class="step">
        <div class="stepNum">3</div>
        <div class="stepBody">
          <div class="stepTitle">A√±adir a pantalla de inicio</div>
          <div class="stepDesc">Ponle nombre y confirma.</div>
        </div>
      </div>
    </div>

    <div class="sheetFooter">
      <button id="btnSheetOk" type="button" class="installBtn btnPrimary" style="width:100%">Entendido</button>
    </div>
  </div>
</div>


</body>
</html>
